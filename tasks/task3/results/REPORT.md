# Отчет о выполнении Задания 3: Личный кабинет (GraphQL Federation)

## Реализованные компоненты:

1. **booking-subgraph**: 
   - Добавлена авторизация ACL на основе заголовка `userid`.
   - Запросы без заголовка или с несовпадающим `userid` отклоняются (ошибка `Forbidden: Cannot access these bookings`).
   - Использована заглушка (mock-массив) для имитации бронирований.

2. **hotel-subgraph**:
   - Добавлен резолвер `__resolveReference` для сущности `Hotel`.
   - Использован `DataLoader` для оптимизации (батчинга) запросов и устранения проблемы N+1.
   - Определение полей `hotel` было вынесено в расширение типа `Booking` в `hotel-subgraph`, чтобы резолвер обращался напрямую к DataLoader (работает батчинг `hotelsByIds`).

3. **promocode-subgraph**:
   - Создан отдельный микросервис для промокодов.
   - Применена схема Federation v2 с директивами `@override` и `@requires`. Поле `discountPercent` переопределено из `booking` подграфа.
   - Интегрирована логика расчета финальной скидки `discountInfo` на базе поля `promoCode`.

4. **apollo-gateway**:
   - Gateway настроен на использование всех трех подграфов.
   - Заголовок `userid` автоматически пробрасывается из `req` в `RemoteGraphQLDataSource` к дочерним графам для валидации ACL.

5. **docker-compose.yml**:
   - Все 4 сервиса (шлюз и 3 подграфа) запускаются через `docker compose up`.
   - Сервисы подключены к одной сети для возможного общения с монолитом.

## Результаты:
В данной директории представлены:
- `docker_ps.txt` - Состояние запущенных контейнеров.
- `success_call.txt` - Успешный federated-ответ со всеми полями из 3 микросервисов.
- `deny_acl.txt` - Ответ с ошибкой доступа по ACL.
- `hotel-subgraph-logs.txt` - Логи работы DataLoader, подтверждающие батчинг и отсутствие N+1 запросов.
