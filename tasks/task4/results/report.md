# Отчет о выполнении Задания 4: Автоматизация развертывания и тестирования

## Описание изменений и решений

В рамках Задания 4 были автоматизированы процессы доставки и развертывания Mock-сервиса `booking-service` в локальный кластер Kubernetes (Minikube).

### 1. Докеризация сервиса
Вместо написания Node.js приложения, был доработан предоставленный Go-исходник:
- Добавлен отсутствующий `go.mod`.
- В код `main.go` добавлен эндпоинт `/health`, который отдает код 200 OK.
- Написан **оптимизированный Multi-stage Dockerfile** (`golang:1.21-alpine` для сборки и `alpine:3.19` для запуска). Это позволило кардинально уменьшить размер финального образа.

### 2. Реализация Helm-чарта
Был полностью сгенерирован Helm-чарт `booking-service` внутри директории `helm/`:
- **Deployment.yaml**: Шаблонизированы параметры количества реплик, имени и тега образа. Настроены переменные окружения (`env`) и ограничения по ресурсам (`requests/limits`).
- **Пробы (Probes)**: Добавлены `livenessProbe` и `readinessProbe`, которые опрашивают эндпоинт `/ping` каждую 10 секунду.
- **Service.yaml**: Создан ClusterIP сервис, слушающий на 80 порту и проксирующий трафик на 8080 порт контейнера.
- **Values**: Созданы три файла:
  - `values.yaml` (базовые настройки).
  - `values-staging.yaml` (1 реплика, урезанные ресурсы, Feature-flag выключен).
  - `values-prod.yaml` (2 реплики, больше ресурсов, Feature-flag включен).

### 3. CI/CD Pipeline (Gitlab-CI)
Настроен автоматический CI/CD процесс в файле `.gitlab-ci.yml`, содержащий 4 стадии:
1. `build`: Сборка образа `docker build`.
2. `test`: Поднятие контейнера локально через `docker run` и проверка ответа на `curl http://localhost:8080/ping`. После валидации контейнер удаляется.
3. `deploy`: Загрузка собранного образа напрямую в Minikube (`minikube image load`) и установка/обновление релиза через `helm upgrade --install`.
4. `tag`: Автоматическое создание Git-тега с текущим timestamp.

Для тестирования пайплайна локально применялась утилита `gitlab-ci-local`.

### 4. Service Discovery (DNS)
Внутри кластера Minikube была успешно протестирована связность сервисов по DNS. Имя `booking-service` успешно резолвится через внутренний `kube-dns`, о чем свидетельствует результат скрипта `check-dns.sh`.
